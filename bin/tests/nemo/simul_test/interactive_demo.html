<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
<title>JCAMP Visualiser</title>
</head>

<body bgcolor="white">
<table border=1>
<tr><td><p><applet code="org.cheminfo.hook.nemo.Nemo"
	archive="ext-lib/jfftpack.jar,ext-lib/blas.jar,ext-lib/blas_simple.jar,ext-lib/f2jutil.jar,ext-lib/lapack.jar,ext-lib/lapack_simple.jar,ext-lib/xerbla.jar,ext-lib/cheminfo.md5.jar,ext-lib/json.jar,ext-lib/httpclient-4.1.3.jar,ext-lib/httpcore-4.1.4.jar,ext-lib/httpmime-4.1.3.jar"
	codebase="../../../" width="800" height="500" name="nemo"> </applet> <br>
From: <input type="text" value=0 name="from" size=4 id="from">
to: <input type="text" value=2 name="to" size=4 id="to"> ppm.
Line Width: <input type="text" value=1 name="lineWidth" size=4 id="lineWidth"> Hz <br>
Max. Cluster size: <input type="text" value=9 name="maxsize" size=4
	id="maxsize"></td>
	<td>
	<form>
		<select id="system" name="menu" size="1" onchange="showtable(this.value);">
	        <option value="1">AB</option>
	        <option value="2">ABC</option>
	        <option value="3">ABCD</option>
	        <option value="4">ABCDE</option>
	    </select>
	</form>
	<br>
	<table id="table2" border=2>
	</table>
	</td>
	<tr>
		<td>
		<button style="background-color:gray" onclick="simulateJW('simulationSimple')">sim. JW(Accurate)</button>
		<button style="background-color:green" onclick="simulateJW2('simulationSimple')">sim. JW2(Faster)</button>
		<br>
</table>

 <textarea id="simulationSimple" rows=12 cols=120>
1	1H	2			1	2	d	5	3	d	15
2	1H	2.02			1	3	d	3
3	1H	4			1
</textarea> <br>


<script language="javascript1.2">
		
function simulateJW(textareaID) {
	textarea=document.getElementById(textareaID);
	from = document.getElementById("from").value;
	to = document.getElementById("to").value;
	lw = document.getElementById("lineWidth").value;
	maxsize = document.getElementById("maxsize").value;
	nemo.clearAll();
	nemo.createNewSpectrum();
	nemo.runScript('simulateJWSpectrum("'+textarea.value.replace(/[\r]/g,"\\r").replace(/[\n]/g,"\\n")+'", 500000000,'+from+', '+to+', '+lw+', "PPM",'+maxsize+');');
	nemo.runScript('zeroFilling(spectraData,16*1024);');
	nemo.runScript('fourierTransform(spectraData);');
	nemo.addSmartPeaksForSimulation(textarea.value,500000000,from,to,"PPM",maxsize);
}
function simulateJW2(textareaID) {
	textarea=document.getElementById(textareaID);
	from = document.getElementById("from").value;
	to = document.getElementById("to").value;
	lw = document.getElementById("lineWidth").value;
	maxsize = document.getElementById("maxsize").value;
	nemo.clearAll();
	nemo.createNewSpectrum();
	nemo.runScript('simulateJW2Spectrum("'+textarea.value.replace(/[\r]/g,"\\r").replace(/[\n]/g,"\\n")+'", 500000000,'+from+', '+to+', '+lw+', "PPM",'+maxsize+');');
	nemo.runScript('zeroFilling(spectraData,16*1024);');
	nemo.runScript('fourierTransform(spectraData);');
	nemo.setColor('dark green');
	nemo.addSmartPeaksForSimulation(textarea.value,500000000,from,to,"PPM",maxsize);
}
function simulateEX(textareaID) {
	textarea=document.getElementById(textareaID);
	from = document.getElementById("from").value;
	to = document.getElementById("to").value;
	lw = document.getElementById("lineWidth").value;
	maxsize = document.getElementById("maxsize").value;
	nemo.clearAll();
	nemo.createNewSpectrum();
	nemo.runScript('simulateExactSpectrum("'+textarea.value.replace(/[\r]/g,"\\r").replace(/[\n]/g,"\\n")+'", 500000000,'+from+', '+to+', '+lw+', "PPM",'+maxsize+');');
	nemo.runScript('zeroFilling(spectraData,16*1024);');
	nemo.runScript('fourierTransform(spectraData);');
	nemo.setColor('dark orange');
	nemo.addSmartPeaksForSimulation(textarea.value,500000000,from,to,"PPM",maxsize);
}
function showtable(option){
	document.getElementById("to").value=option*1+2;

	addTable(option*1+1);
	simulate();
	
}

function addTable(size){
    allRows=document.getElementById("table2");
    //Deleting all rows of this table
    while(allRows.hasChildNodes())
    {
    	allRows.removeChild(allRows.firstChild);
    }
	//Adding new ones
	
	var tableHeader="<tr><th>delta (ppm)</th>";
	for(var i=1; i<size;i++) {
		tableHeader+="<th>J<sub>"+i+"-</sub> (Hz)</th>";
	}

	tableHeader+="</tr>";
	document.getElementById("table2").innerHTML=tableHeader;
		
	
	for(var i=0; i<size+1;i++){
		addRow(i);
	}
	
}

function simulate() {
	getSpinTable();
	// simulateEX('simulationSimple');
	simulateJW('simulationSimple');
}

function addRow(numRows)
{
		 tabBody=document.getElementById("table2");
         row=document.createElement("TR");
         var algo;
         for(var i=0;i<numRows;i++){
             var inputName= 'input'+numRows+'_'+i.toString();
             cell1 = document.createElement("TD");
             var input = document.createElement('INPUT');
             input.setAttribute('id', inputName);
             input.setAttribute('size', '4');
             if (i==0) {
      	       input.setAttribute('value', numRows);
             } else {
            	input.setAttribute('value', '7');
             }
             input.onchange = function(){
            	 var table = getSpinTable();
            	 simulate();
             }

             
             var buttonPlus = document.createElement('BUTTON');
             var buttext = document.createTextNode('>');
             buttonPlus.appendChild(buttext);
             buttonPlus.setAttribute('ID', "plus"+inputName);
             buttonPlus.onclick = function(){
            	 inputk=document.getElementById(this.getAttribute("ID").replace("plus",""));
            	 inputk.value=inputk.value*1+0.1;
            	 var table = getSpinTable();
            	simulate();
             }
             var buttonMinus = document.createElement('BUTTON');
             buttext = document.createTextNode('<');
             buttonMinus.appendChild(buttext);
             buttonMinus.setAttribute('ID', "minus"+inputName);
             buttonMinus.onclick = function() {
            	 inputk=document.getElementById(this.getAttribute("ID").replace("minus",""));
            	 inputk.value=inputk.value*1-0.1;
            	 var table = getSpinTable();
            	 simulate();
			}
             cell1.appendChild(input);
             cell1.appendChild(buttonMinus);
             cell1.appendChild(buttonPlus);
             row.appendChild(cell1);
         }
         tabBody.appendChild(row); 
}
function getSpinTable(){
	//The fist colunm has the shift, the another columns has the constans couplings
	//tableRows=document.getElementById("table2").getElementsByTagName('tr');
	var tabRows=document.getElementById("table2").getElementsByTagName('tr');
	table = document.getElementById("simulationSimple");
	var stringTable ='*';
	var rows = tabRows.length;
	for(var i=1;i<rows-1;i=i+1){
		rowi=tabRows[i+1].getElementsByTagName('input');
		stringTable=stringTable+i+'\t1H\t'+rowi[0].value+'\t\t\t1';
		for(var j=1;j<rowi.length;j=j+1){
			stringTable='\t'+stringTable+'\t'+j+'\td\t'+rowi[j].value
		}
		stringTable=stringTable+'\r\n'
	}
	stringTable=stringTable.substring(stringTable.indexOf('*')+1);
	//alert(stringTable);
	document.getElementById("simulationSimple").value=stringTable;
}
showtable(1);
</script>
</body>

</html>